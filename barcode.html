<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Barcode & QR Code Scanner</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        #reader {
            width: 500px;
            margin: 20px auto;
        }
        #result {
            font-weight: bold;
            font-size: 1.2em;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        #stopButton {
            background-color: #f44336;
            color: white;
            border: none;
        }
        #startButton {
            background-color: #4CAF50;
            color: white;
            border: none;
        }
    </style>
</head>
<body>
    <h1>Simple Barcode & QR Code Scanner</h1>
    <p>Tap "Start Scanning" and point your iPhone camera at a barcode or QR code.</p>

    <div id="reader"></div>

    <button id="startButton">Start Scanning</button>
    <button id="stopButton" style="display:none;">Stop Scanning</button>

    <p>Scanned Code: <span id="result">No code scanned yet.</span></p>

    <script src="https://cdn.jsdelivr.net/npm/html5-qrcode/minified/html5-qrcode.min.js"></script>

    <script>
        // Function to handle a successful scan
        function onScanSuccess(decodedText, decodedResult) {
            console.log(`Code matched = ${decodedText}`, decodedResult);
            document.getElementById('result').innerText = decodedText;

            // Optional: Log the type of code found
            console.log("Scanned format: " + decodedResult.result.format.formatName);
        }

        // Function to handle scan errors (optional)
        function onScanFailure(error) {
            // This is often triggered, so we'll just log it
            // console.warn(`Code scan error = ${error}`);
        }

        const html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", { fps: 10, qrbox: { width: 250, height: 250 } },
            /* verbose= */ false);

        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');

        startButton.addEventListener('click', () => {
            // Start the scanner and hide the start button
            html5QrcodeScanner.render(onScanSuccess, onScanFailure);
            startButton.style.display = 'none';
            stopButton.style.display = 'block';
            document.getElementById('result').innerText = "Scanning...";
        });

        stopButton.addEventListener('click', () => {
            // Stop the scanner and show the start button
            html5QrcodeScanner.stop().then(() => {
                console.log("Scanner stopped.");
                startButton.style.display = 'block';
                stopButton.style.display = 'none';
                document.getElementById('result').innerText = "No code scanned yet.";
            }).catch(err => {
                console.log("Error stopping scanner: " + err);
            });
        });
    </script>
</body>
</html>
